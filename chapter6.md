# 第 6 章：节奏织体与打击乐——从板鼓到 Zimmer Drums

## 1. 开篇：节奏是空间，不是时间

在 Sonic Pi 代码中，节奏往往体现为时间（`sleep`），但在听感设计上，节奏体现为**频段的占有（Spectrum Occupation）**和**空间的塑造（Spatial Design）**。

*   **古风/戏腔**的节奏是**点状**的：它是空灵空间中的几个脆响，用来提示歌手的换气和情绪转折（板眼）。
*   **久石让风格**的节奏是**色彩状**的：它往往是高频的沙锤、风铃或轻军鼓，像调料一样撒在钢琴和弦乐上。
*   **Hans Zimmer 风格**的节奏是**块状/墙状**的：它是巨大的低频脉冲（Pulse）和 16 分音符的滚奏，填满整个声场，产生压迫感。

本章的任务，是让你学会根据风格需求，用代码“捏”出这三种形态的鼓。

---

## 2. 频谱分层策略 (Spectrum Layering Strategy)

既然你熟悉频谱分析，构建打击乐的第一原则就是：**不要试图用一个采样完成所有频段的任务。** 一个好听的电影感大鼓（Cinematic Kick），通常是由 2-3 层声音叠加而成的。

### 2.1 频段分工图 (Rule of Thumb)

我们将打击乐器分为三个频段层级，编写代码时，建议将这三层写在不同的 `live_loop` 或函数中，以独立控制混响和音量。

```text
频段 (Hz)      | 角色 (Role)             | 物理特性与 Sonic Pi 策略
---------------|-------------------------|---------------------------------------------
Low (20-100Hz) | 地基 / Sub              | 负责震动裤脚，提供“重量”。
               |                         | 策略：单声道(Mono)，无混响(Dry)，短包络。
               |                         | 推荐：:bd_tek (加 LPF), :drum_heavy_kick
---------------|-------------------------|---------------------------------------------
Mid (200-2k Hz)| 骨架 / Body             | 负责听感上的“砰”或“咚”，提供材质感。
               |                         | 策略：可以有一点短混响，带有音高感。
               |                         | 推荐：:drum_tom_mid_soft, :drum_snare_soft
---------------|-------------------------|---------------------------------------------
High (2k Hz+)  | 空气 / Transient        | 负责“咔”或“滋”，提供清晰的拍点定位。
               |                         | 策略：宽立体声(Pan)，长混响(Air)。
               |                         | 推荐：:drum_cymbal_closed, :elec_tick
```

> **常见错误**：初学者常觉得鼓不够劲，于是把 `:bd_haus` 的音量开到 2.0。这会导致数字削波（Clipping）和浑浊。
> **正确做法**：叠加一个正弦波合成器（Synth）作为 Sub 层，叠加一个高频的 Noise 作为打击头（Transient），保持总音量不过载。

---

## 3. 华语古风与戏腔节奏：板眼与留白

古风打击乐的核心审美是**“清、脆、疏”**。它忌讳持续不断的低频轰炸。

### 3.1 “板眼”体系的代码化
中国传统戏曲节奏统称“板眼”。“板”是强拍（通常由板鼓/梆子击打），“眼”是弱拍。
*   **一板三眼** (4/4 拍)：强 - 弱 - 次强 - 弱。
*   **一板一眼** (2/4 拍)：强 - 弱。
*   **无板无眼** (散板)：自由节奏，由演唱者导，乐器跟随。

在 Sonic Pi 中，我们用高频木质音色来模拟“板”。

#### 关键音色设计
*   **板鼓 (Bangu)**：极干、高音、穿透力强。
    *   *Recipe*: 使用 `:elec_wood` 或 `:perc_snap`，将 `rate` 设为 1.5 到 2.0（提调音高），`release` 设极短（0.1）。
*   **大堂鼓 (Tanggu)**：低沉、余韵长。
    *   *Recipe*: 使用 `:bd_zum`，加上 `lpf: 100`（去掉电子味），放在巨大的 `reverb` 效果器中。

### 3.2 常用节奏型：弱起与后半拍
古风的韵味常来自于“不到重拍上”。
*   **凤点头**：在正拍之前的一个十六分音符轻击。
*   **切分推进**：在第 2 拍和第 4 拍的后半拍重击。

```text
古风常用节奏示意 (X=板/重, o=弱起/装饰, . = 休止/留白)
[1]       [2]       [3]       [4]
X . . .   . . o X   . . . .   . . . .  (注重第2拍后半拍的切分)
```

---

## 4. Hans Zimmer 式配乐：脉冲与 16 分音符网格

Zimmer 风格（Action Score）的核心**驱动力（Drive）**。这通常通过 **Ostinato（固定音型）** 来实现。

### 4.1 16 分音符脉冲 (The 16th Note Pulse)
这不是简单的“动次打次”，而是一个快速滚动的 16 分音符流。
*   **核心逻辑**：乐器（通常是弦乐断奏 + 合成器 + 打击乐）不停演奏 16 分音符。
*   **重音编组**：通过改变重音位置来改变律动。
    *   **3+3+2 模式**：**1** 2 3 **1** 2 3 **1** 2
    *   **4+4 模式**：**1** 2 3 4 **1** 2 3 4
*   **Sonic Pi 实现**：利用 `ring` 和 `tick` 来控制振幅（Amp）或 滤波器截止频率（Cutoff）。

```ruby
# 伪代码思路：Zimmer 脉冲
# 定义一个重音模式环：3+3+2
accents = (ring 1.2, 0.6, 0.6,  1.2, 0.6, 0.6,  1.2, 0.6)

live_loop :zimmer_pulse do
  # 使用 tick 读取重音，并叠加一个随机波动让它像真人
  vol = accents.tick * rrand(0.9, 1.1)
  
  # 关键：用 lpf (Low Pass Filter) 随时间慢慢打开，制造逼近感
  cutoff_val = (line 60, 110, steps: 128).look 
  
  sample :bd_tek, amp: vol, lpf: cutoff_val
  sleep 0.25 # 16分音符
end
```

### 4.2 史诗打击乐 (Epic Percussion Ensemble)
Zimmer 的鼓听起来大，是因为那是“群奏”（Ensemble）。
*   **Taiko / Surdo**：中低频的主力。
*   **Anvil / Metal**：金属撞击声，用于最高潮的重音。
*   **Riser / Whoosh**：这不是鼓，但作为打击乐的一部分，用于段落过渡前的“吸气声”。

**Rule of Thumb**: 当你要写史诗高潮时，不要只加音量。要**加层数**。在重拍叠加一个 `:drum_splash_hard`（并将速率调低 `rate: 0.5` 制造巨大的工业噪音感）。

---

## 5. 节奏的“人性化” (Humanization)

你是程序员，但你的听众是人。完全精准的网格会让耳朵疲劳（Ear Fatigue）。

### 5.1 微时值偏移 (Micro-timing)
真人鼓手从不完全准。在 100 BPM 下，几毫秒的误差就是“律动”。
*   **Swing (摇摆)**：在偶数个 16 分音符上加一点点延迟。
*   **Gaussian Blur**：在 `sleep` 时间上加一个极小的随机数。
    *   `sleep 0.25 + rrand(-0.01, 0.01)`（注意不要累积误差，建议使用 `time_warp` 或在固定 `live_loop` 框架内微调 `sample` 的触发时间，而非 `sleep` 时间）。

### 5.2 力度与音色的动态
*   **Velocity Layering (模拟)**：真实的鼓，敲得越重，高频越亮。
    *   *Sonic Pi 技巧*：将 `amp` 和 `cutoff` 绑定。`amp` 越大，`cutoff` 越高。
    *   `sample :drum_snare_hard, amp: v, cutoff: 80 + v * 40`

---

## 6. 本章小结

*   **分层思维**：低频（Sub/Kick）给身体，中频（Body/Snare）给骨架，高频（Air/Hat）给清晰度。不要让它们混在一起。
*   **古风逻辑**：用高频木质音色（`:elec_wood`）做“板”，注重留白和弱起，不要填满。
*   **Zimmer 逻辑**：16 分音符脉冲是核心。使用 `ring` 定义重音模式（如 3+3+2），利用滤波器自动化（Filter Sweep）制造推进感。
*   **人性化**：通过 `rrand` 给音量、音色（cutoff/rate）和微时值增加随机性，避免“机器味”。

---

## 7. 练习题

### 基础题（熟悉材料）

**习题 6.1：古风“慢板”构建**
目标：写一个 BPM 60 的 4/4 拍古风节奏。
1.  使用 `:elec_wood` 模拟板鼓，只在第 1 拍（强）和第 3 拍（次强）击打。
2.  使用 `:drum_cymbal_soft` 模拟镲片，在第 4 拍的后半拍（4.5）轻轻击打，作为弱起。
3.  给它们加上较长的 Reverb。

<details>
<summary>点击查看提示 (Hint)</summary>
使用 `live_loop` 和 `sleep`。对于第 4.5 拍，可以先 `sleep 3.5` 播放镲片，再 `sleep 0.5` 完成循环（或者使用 pattern 数组）。注意 `rate` 参数可以让 wood 听起来更像硬木。
</details>

<details>
<summary>点击查看参考答案思路</summary>
*   建立一个 live_loop。
*   Sample :elec_wood (拍子1)。
*   Sleep 2。
*   Sample :elec_wood (拍子3，amp 稍微小点)。
*   Sleep 1.5。
*   Sample :drum_cymbal_soft (拍子4.5作为下一小节的引导)。
*   Sleep 0.5。
</details>

**习题 6.2：Zimmer 的 3+3+2 脉冲**
目标：写一个 BPM 120 的动作片基底。
1.  创建一个 16 分音符的循环（`sleep 0.25`）。
2.  创建一个重音 `ring`：`(ring 1, 0, 0, 1, 0, 0, 1, 0)`。
3.  当值为 1 时，播放低音 Kick（`:bd_tek`）；当值为 0 时，播放轻一点的闭镲（`:drum_cymbal_closed`）或者极轻的 Kick。

<details>
<summary>点击查看提示 (Hint)</summary>
利用 `tick` 遍历 ring。在 `sample` 命令中，利用 `if` 或者直接将 amp 乘以 ring 的值来控制发声。
</details>

### 挑战题（进阶设计）

**习题 6.3：自定义“大堂鼓”音色设计**
目标：Sonic Pi 自带的鼓都不像中国大鼓。请利用 DSP 知识调制一个。
1.  选择一个基础采样（建议 `:bd_zum` 或 `:drum_tom_lo_hard`）。
2.  **音色塑形**：大鼓不应该有太多高频，使用 `lpf` 切掉 400Hz 以上。
3.  **空间塑形**：大鼓应该有很沉的共鸣。尝试叠加一个 `sample :bd_boom` 但把它的 `rate` 降得很低，音量很小。
4.  **环境**：包裹在 `with_fx :reverb, room: 0.8` 中。

<details>
<summary>点击查看提示 (Hint)</summary>
这是关于 Layering 的练习。
Layer A: 击打头 (Transient) -> `:drum_tom_lo_hard`, amp: 1
Layer B: 共鸣体 (Body) -> `:bd_zum`, lpf: 300, amp: 0.8
Layer C: 极低频 (Sub) -> `:bd_boom`, amp: 0.5, rate: 0.8
将它们放在同一个 `do...end` 块中同时触发。
</details>

**习题 6.4：自动化过门 (The Build-up)**
目标：写一个 8 小节的循环。前 7 小节是平稳的 16 分音符脉冲，第 8 小节进行过门。
要求：
1.  在第 8 小节，鼓点的密度加倍（变成 32 分音符，或者变成滚奏）。
2.  或者，在第 8 小节，高通滤波器（HPF）从 0 升到 100，让低频逐渐消失，只剩下高频，为下一个段落的 Drop 做准备。

<details>
<summary>点击查看提示 (Hint)</summary>
使用 `beat` 或计数器判断当前是第几小节。
`look` 可以获取当前的 tick 数。
`cutoff_slide` 可以实现参数的平滑滑动，或者使用 `line` 构建一个随时间变化的参数序列。
</details>

---

## 8. 常见陷阱与错误 (Gotchas)

### 8.1 陷阱：低频“打架”与相位抵消
**现象**：当你叠加了合成器贝斯（Bass）和底鼓（Kick）时，有时声音反而变小了，或者忽大忽小。
**原因**：两个低频波形在某个瞬间相位相反（一个波峰遇到一个波谷），互相抵消了。
**调试技巧**：
1.  **侧链压缩（Sidechain）思路**：这是电子音乐的标配。当 Kick 响的时候，Bass 必须瞬间变小。在 Sonic Pi 中，可以通过控制 Bass 的 `amp` 包络，或者简单的“让位”原则——尽量不要让长音 Bass 的起音（Attack）和 Kick 这种强瞬态完全重合。
2.  **切低频**：确保除了 Kick 和 Sub Bass 之外，其他所有乐器（包括军鼓、人声、旋律）都加了 `hpf: 100`（高通滤波）。低频空间很挤闲人免进。

### 8.2 陷阱：`sleep` 的误解
**现象**：代码里写了 `sleep 0.25`，但加上复杂的 `with_fx` 后，节奏好像变慢了。
**解释**：Sonic Pi 的调度是非常精准的，通常不会变慢。如果你觉得慢了，可能是：
1.  **CPU 过载**：太多实时效果器导致音频丢帧（表现为爆音或卡顿）。
2.  **听觉错觉**：过大的混响（Reverb）或延迟（Echo）模糊了瞬态，让节奏听起来“拖泥带水”。
**解决**：对于节奏组，混响的 `pre_amp` 或 `mix` 不要太大。保持鼓点的干脆（Dry）。

### 8.3 陷阱：死板的音量
**现象**：鼓组听起来像 80 年代的 MIDI 铃声。
**原因**：所有音符的 `amp` 都是 1。
**Rule of Thumb**：永远不要写 `amp: 1`。习惯写 `amp: rrand(0.7, 0.9)`。如果是重音，写 `amp: rrand(0.9, 1.1)`。这一点的差别是巨大的。
